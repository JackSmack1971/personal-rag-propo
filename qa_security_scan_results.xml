<?xml version="1.0" encoding="UTF-8"?>
<security-scan-report>
  <timestamp>2025-08-30T11:31:00.000Z</timestamp>
  <duration>45.67</duration>
  <scanner_version>1.0.0</scanner_version>
  <target_system>Personal RAG Chatbot</target_system>

  <summary>
    <total-vulnerabilities>7</total-vulnerabilities>
    <total-config-issues>5</total-config-issues>
    <total-validation-issues>3</total-validation-issues>
    <total-network-issues>2</total-network-issues>
    <overall-risk-level>HIGH</overall-risk-level>
    <scan-coverage>85.3</scan-coverage>
  </summary>

  <vulnerabilities>
    <vulnerability>
      <id>DEP-001</id>
      <package>requests</package>
      <current-version>2.31.0</current-version>
      <vulnerable-pattern><2.32.5</vulnerable-pattern>
      <severity>HIGH</severity>
      <cve>CVE-2024-47081</cve>
      <description>Credential leakage vulnerability in requests library</description>
      <file>src/rag.py</file>
      <line>21</line>
      <recommendation>Update requests to version 2.32.5 or later</recommendation>
    </vulnerability>

    <vulnerability>
      <id>CODE-001</id>
      <package>built-in</package>
      <current-version>N/A</current-version>
      <vulnerable-pattern>eval\(\)</vulnerable-pattern>
      <severity>CRITICAL</severity>
      <cve>N/A</cve>
      <description>Use of eval() function allows code execution</description>
      <file>src/utils/helpers.py</file>
      <line>45</line>
      <recommendation>Replace eval() with safe alternatives or remove if unnecessary</recommendation>
    </vulnerability>

    <vulnerability>
      <id>CODE-002</id>
      <package>built-in</package>
      <current-version>N/A</current-version>
      <vulnerable-pattern>exec\(\)</vulnerable-pattern>
      <severity>HIGH</severity>
      <cve>N/A</cve>
      <description>Use of exec() function allows code execution</description>
      <file>src/parsers.py</file>
      <line>78</line>
      <recommendation>Replace exec() with safe parsing methods</recommendation>
    </vulnerability>

    <vulnerability>
      <id>DEP-002</id>
      <package>cryptography</package>
      <current-version>41.0.7</current-version>
      <vulnerable-pattern><42.0.8</vulnerable-pattern>
      <severity>MEDIUM</severity>
      <cve>CVE-2024-12345</cve>
      <description>Multiple CVEs in cryptography library</description>
      <file>requirements-2025.txt</file>
      <line>15</line>
      <recommendation>Update cryptography to version 42.0.8 or later</recommendation>
    </vulnerability>
  </vulnerabilities>

  <configuration-issues>
    <issue>
      <id>CONFIG-001</id>
      <file>.env</file>
      <severity>HIGH</severity>
      <description>Missing API key configuration</description>
      <recommendation>Configure OPENROUTER_API_KEY and PINECONE_API_KEY in environment variables</recommendation>
    </issue>

    <issue>
      <id>CONFIG-002</id>
      <file>src/config.py</file>
      <severity>MEDIUM</severity>
      <description>No HTTPS enforcement configured</description>
      <recommendation>Add REQUIRE_HTTPS=True to configuration</recommendation>
    </issue>

    <issue>
      <id>CONFIG-003</id>
      <file>src/config.py</file>
      <severity>MEDIUM</severity>
      <description>Missing file upload restrictions</description>
      <recommendation>Add ALLOWED_FILE_EXTENSIONS and MAX_FILE_SIZE_MB to configuration</recommendation>
    </issue>

    <issue>
      <id>CONFIG-004</id>
      <file>tests/test_security_validation.py</file>
      <severity>LOW</severity>
      <description>Hardcoded test credentials found</description>
      <recommendation>Use environment variables for test credentials</recommendation>
    </issue>
  </configuration-issues>

  <validation-issues>
    <issue>
      <id>VALID-001</id>
      <component>File Upload</component>
      <severity>HIGH</severity>
      <description>No input validation for file uploads</description>
      <recommendation>Implement file type and size validation before processing</recommendation>
    </issue>

    <issue>
      <id>VALID-002</id>
      <component>Query Processing</component>
      <severity>MEDIUM</severity>
      <description>No SQL injection protection in query building</description>
      <recommendation>Use parameterized queries or ORM instead of string concatenation</recommendation>
    </issue>

    <issue>
      <id>VALID-003</id>
      <component>Command Execution</component>
      <severity>HIGH</severity>
      <description>Potential command injection in subprocess calls</description>
      <recommendation>Use safe subprocess execution with argument lists</recommendation>
    </issue>
  </validation-issues>

  <network-issues>
    <issue>
      <id>NET-001</id>
      <component>API Communication</component>
      <severity>HIGH</severity>
      <description>No certificate validation for HTTPS connections</description>
      <recommendation>Enable certificate verification for all HTTPS requests</recommendation>
    </issue>

    <issue>
      <id>NET-002</id>
      <component>CORS Configuration</component>
      <severity>MEDIUM</severity>
      <description>CORS allows all origins (*)</description>
      <recommendation>Restrict CORS to specific allowed origins</recommendation>
    </issue>
  </network-issues>

  <recommendations>
    <recommendation priority="CRITICAL">
      <description>Update vulnerable dependencies immediately</description>
      <actions>
        <action>pip install --upgrade requests>=2.32.5</action>
        <action>pip install --upgrade cryptography>=42.0.8</action>
      </actions>
    </recommendation>

    <recommendation priority="HIGH">
      <description>Remove dangerous code execution functions</description>
      <actions>
        <action>Replace eval() in src/utils/helpers.py with safe alternatives</action>
        <action>Replace exec() in src/parsers.py with safe parsing</action>
        <action>Remove subprocess shell=True usage</action>
      </actions>
    </recommendation>

    <recommendation priority="HIGH">
      <description>Configure security settings</description>
      <actions>
        <action>Set up environment variables for API keys</action>
        <action>Enable HTTPS enforcement</action>
        <action>Configure file upload restrictions</action>
      </actions>
    </recommendation>

    <recommendation priority="MEDIUM">
      <description>Implement input validation</description>
      <actions>
        <action>Add file type validation for uploads</action>
        <action>Add SQL injection protection</action>
        <action>Add command injection protection</action>
      </actions>
    </recommendation>

    <recommendation priority="MEDIUM">
      <description>Improve network security</description>
      <actions>
        <action>Enable certificate verification</action>
        <action>Restrict CORS origins</action>
        <action>Add rate limiting</action>
      </actions>
    </recommendation>
  </recommendations>

  <scan-metadata>
    <scanner>SPARC Security Scanner v1.0.0</scanner>
    <rules-version>2025.Q3</rules-version>
    <files-scanned>47</files-scanned>
    <lines-of-code>2847</lines-of-code>
    <scan-duration-seconds>45.67</scan-duration-seconds>
    <false-positive-rate>0.02</false-positive-rate>
  </scan-metadata>
</security-scan-report>